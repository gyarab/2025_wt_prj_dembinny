{% extends 'base.html' %}
{% block title %}How to Pay â€” Class Fund Manager{% endblock %}

{% block content %}

<div class="page-header">
    <h1>ğŸ¦ How to Pay</h1>
    <a href="{% url 'dashboard' %}">â† Back to Dashboard</a>
</div>

<div class="payment-layout">

    {% if account %}

    <!-- Account details -->
    <div class="account-card">
        <h2>Class Bank Account</h2>

        <div class="detail-row">
            <span class="field-label">Account Holder</span>
            <span class="field-value">{{ account.owner_name }}</span>
        </div>

        <div class="detail-row">
            <span class="field-label">Account Number</span>
            <span class="field-value" id="account-number">{{ account.account_number }}</span>
            <button class="copy-btn" onclick="copyField('account-number', this)">Copy</button>
        </div>

        {% if account.iban %}
        <div class="detail-row">
            <span class="field-label">IBAN</span>
            <span class="field-value" id="iban">{{ account.iban }}</span>
            <button class="copy-btn" onclick="copyField('iban', this)">Copy</button>
        </div>
        {% endif %}

        {% if account.bank_name %}
        <div class="detail-row">
            <span class="field-label">Bank</span>
            <span class="field-value">{{ account.bank_name }}</span>
        </div>
        {% endif %}

        {% if account.note %}
        <div class="note-box">
            ğŸ“Œ <strong>Note from the treasurer:</strong><br>
            {{ account.note|linebreaksbr }}
        </div>
        {% endif %}
    </div>

    <!-- QR code -->
    <div class="qr-card">
        <h3>ğŸ“± Scan to Pay</h3>
        {% if qr_base64 %}
        <img src="data:image/png;base64,{{ qr_base64 }}" alt="Payment QR code">
        <p>Open your banking app and scan<br>this Czech Payment QR (SPD).</p>
        {% else %}
        <div
            style="width:200px;height:200px;background:#f5f7fa;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#aaa;font-size:.85rem;text-align:center;padding:1rem;">
            QR code not available
        </div>
        <p>Add an IBAN or account number<br>in the admin panel to enable QR.</p>
        {% endif %}
    </div>

    {% else %}

    <!-- No account configured yet -->
    <div class="placeholder-banner">
        <div class="icon">ğŸ—ï¸</div>
        <h2>Payment details not yet configured</h2>
        <p>The class treasurer hasn't set up the bank account details yet. Check back soon!</p>
        {% if user.is_treasurer %}
        <a href="/admin/app/bankaccount/add/"
            style="display:inline-block;margin-top:1.25rem;background:#1a1a2e;color:#e2b96f;padding:.6rem 1.4rem;border-radius:6px;text-decoration:none;font-weight:600;">
            Add Bank Account â†’
        </a>
        {% endif %}
    </div>

    {% endif %}

</div>

<script>
    function copyField(id, btn) {
        const text = document.getElementById(id).textContent.trim();
        navigator.clipboard.writeText(text).then(() => {
            btn.textContent = 'âœ“ Copied';
            btn.classList.add('copied');
            setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        });
    }
</script>
{% endblock %}